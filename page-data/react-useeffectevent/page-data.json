{"componentChunkName":"component---src-templates-blog-post-js","path":"/react-useeffectevent/","result":{"data":{"site":{"siteMetadata":{"title":"Chris' Dialogue"}},"markdownRemark":{"id":"129d0698-7628-5c3d-a3a6-0858c5508e16","excerpt":"React 19.2 came with latest hook named  Documentation While I understand the need, I don’t like their API surface. Just like useEffect , useEffectEvent comes…","html":"<p>React 19.2 came with latest hook named <code class=\"language-text\">useEffectEvent</code></p>\n<p><a href=\"https://react.dev/reference/react/useEffectEvent\">Documentation</a></p>\n<p>While I understand the need, I don’t like their API surface.</p>\n<p>Just like useEffect , useEffectEvent comes with a lot of caveat, documented in React documentation itself in <a href=\"https://react.dev/learn/separating-events-from-effects#limitations-of-effect-events\">this link</a>. In short, you must manually check that you\nOnly call them from inside Effects.\nNever pass them to other components or Hooks.</p>\n<p>I don’t like that useEffectEvent has this secret that one need to know really deep to wield it properly.\nFor simpler API, I think we can just design it like this</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> event1<span class=\"token punctuation\">,</span> event2 <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Normal useEffect code</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>deps<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Event functions that need to be fired in useEffect</span>\n  <span class=\"token function-variable function\">event1</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">event2</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>To adopt from React document example, it would look like this</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useEffect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">ChatRoom</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> roomId<span class=\"token punctuation\">,</span> theme <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> onConnected <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> connection <span class=\"token operator\">=</span> <span class=\"token function\">createConnection</span><span class=\"token punctuation\">(</span>serverUrl<span class=\"token punctuation\">,</span> roomId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    connection<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'connected'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">onConnected</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    connection<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">disconnect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>roomId<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">onConnected</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">showNotification</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Connected!'</span><span class=\"token punctuation\">,</span> theme<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>With this API design, you can force developers to:\nCall them only inside useEffect. There is no way to call these functions outside of the useEffect scope.\nDisable passing any of these event functions to other components. There is no way to pass these functions to other components.</p>\n<p>Sure, the downside is that you can now only have one event per one useEffect, but in my opinion, it is extremely rare to have a shared useEffectEvent.\nIn those rare cases, we can use memoized functions passing through this event, and I guess the React Compiler can take care of memoizing functions that are only used in shared useEffects, in case performance drops during rendering.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">sharedFunction</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/* code */</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> event1 <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Normal useEffect code</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>deps<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n<span class=\"token literal-property property\">event1</span><span class=\"token operator\">:</span> sharedFunction\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> event2 <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Another useEffect code</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>deps<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n<span class=\"token literal-property property\">event2</span><span class=\"token operator\">:</span> sharedFunction\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>I may be missing some limitation, as I am not one of the people who built React. If this is not technically possible because of some (presumably) legacy React limitation, then fine.</p>\n<p>But if there is no legacy limitation, I think the React team is now too attached to the semantics of hook and use.</p>\n<p>In general, it is better to design an API that prevents the developer from making mistakes altogether rather than allow them and then write another section in the documentation saying, “don’t do this because…“.</p>\n<p>Or, as many folks in functional programming would say.</p>\n<blockquote>\n<p>Make illegal states unrepresentable</p>\n</blockquote>\n<p>I would say</p>\n<blockquote>\n<p>Make illegal code unwritable</p>\n</blockquote>\n<p>And in my opinion, it is much better to bend away from semantic of hook but have an API that make illegal code unwritable, rather than stay with consistent semantic and now we need to have document say “don’t do that”.</p>\n<p>There is a value in having consistent semantic, but again in my opinion, not at the cost of making illegal code easy to write.</p>\n<p>This is just a rant.</p>\n<p>By the way, I am always a fan of React and use it since React 0.x. So I don’t intend to bash React as a whole.</p>\n<p>But I would say there are certain API design in React that is quite unwieldy lately.</p>","frontmatter":{"title":"I don't like React's useEffectEvent Api","date":"October 10, 2025","description":null}},"previous":{"fields":{"slug":"/enneagram/"},"frontmatter":{"title":"Enneagram content"}},"next":null},"pageContext":{"id":"129d0698-7628-5c3d-a3a6-0858c5508e16","previousPostId":"533c93a7-2506-5d73-b73d-7cff79f99b71","nextPostId":null}},"staticQueryHashes":["1033745147","2841359383"],"slicesMap":{}}